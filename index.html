<!doctype HTML>
<html>
<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
<script>
  AFRAME.registerComponent('markerhandler', {
    init: function () {
      this.el.sceneEl.addEventListener('markerFound', () => {
        var moles = [
        document.getElementById('mole1'),
        document.getElementById('mole2'),
        document.getElementById('mole3'),
        document.getElementById('mole4'),
        document.getElementById('mole5'),
        document.getElementById('mole6'),
        document.getElementById('mole7'),
        document.getElementById('mole8'),
      ];
      
      function moveMoleUpAndDown(mole) {
        let startY = -0.5; // Start below the surface
        let targetY = 0.5; // End above the surface
        let duration = 1000; // Duration in milliseconds
        let startTime = null;

        function animate(time) {
          startTime = startTime || time;
          let elapsedTime = time - startTime;
          let fraction = elapsedTime / duration;

          if (fraction < 1) {
            let newY = startY + (targetY - startY) * fraction; // Linear interpolation
            mole.object3D.position.y = newY;
            requestAnimationFrame(animate); // Continue animation
          } else {
            mole.object3D.position.y = targetY; // Ensure it ends at the exact target position

            // After a pause, start moving down
            setTimeout(() => moveMoleUpAndDown(mole, startY, duration), 2000); // Pause at the top
          }
        }

        requestAnimationFrame(animate);
      }

      function moveMoleDown(mole, startY, duration) {
        let startTime = null;
        let targetY = -2; // Move back below the surface
        function animate(time) {
          startTime = startTime || time;
          let elapsedTime = time - startTime;
          let fraction = elapsedTime / duration;

          if (fraction < 1) {
            let newY = startY * (1 - fraction); // Linear interpolation for moving down
            mole.object3D.position.y = newY;
            requestAnimationFrame(animate);
          } else {
            mole.object3D.position.y = targetY; // Ensure it ends at the exact target position
          }
        }

        requestAnimationFrame(animate);
      }
      
      moles.forEach((mole) => {
        setInterval(() => moveMoleUpAndDown(mole), 6000); // Adjust timing as needed
      });
    }
  });
</script>
<body style="margin: 0px; overflow: hidden;">
<a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;' vr-mode-ui="enabled: false">
    <a-marker type="barcode" value="6">
        <a-entity id="mole1" position="-2 -2 2" scale="0.05 0.05 0.05" gltf-model="url(/ar/scene.gltf)"></a-entity>
        <a-entity id="mole2" position="0 -2 2" scale="0.05 0.05 0.05" gltf-model="url(/ar/scene.gltf)"></a-entity>
        <a-entity id="mole3" position="2 -2 2" scale="0.05 0.05 0.05" gltf-model="url(/ar/scene.gltf)"></a-entity>
        <a-entity id="mole4" position="-2 -2 0" scale="0.05 0.05 0.05" gltf-model="url(/ar/scene.gltf)"></a-entity>
        <a-entity id="mole5" position="2 -2 0" scale="0.05 0.05 0.05" gltf-model="url(/ar/scene.gltf)"></a-entity>
        <a-entity id="mole6" position="-2 -2 -2" scale="0.05 0.05 0.05" gltf-model="url(/ar/scene.gltf)"></a-entity>
        <a-entity id="mole7" position="0 -2 -2" scale="0.05 0.05 0.05" gltf-model="url(/ar/scene.gltf)"></a-entity>
        <a-entity id="mole8" position="2 -2 -2" scale="0.05 0.05 0.05" gltf-model="url(/ar/scene.gltf)"></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>
</script>
</body>
</html>
